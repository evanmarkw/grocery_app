<div class="product-management-container min-h-screen">
  <p-toolbar>
    <ng-template pTemplate="start">
      <div class="flex align-items-center gap-2">
        <p-button
          icon="pi pi-arrow-left"
          (onClick)="goBack()"
          [text]="true"
        ></p-button>
        <span class="text-xl font-bold">Product Management</span>
      </div>
    </ng-template>
    <ng-template pTemplate="end">
      <p-button
        label="Add Product"
        icon="pi pi-plus"
        (onClick)="showAddDialog()"
      ></p-button>
    </ng-template>
  </p-toolbar>

  <div class="p-4">
    <p-table
      [value]="products"
      [loading]="loading"
      [paginator]="true"
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} products"
      [rowsPerPageOptions]="[10, 25, 50]"
      styleClass="p-datatable-striped"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>SKU</th>
          <th>Name</th>
          <th>Category</th>
          <th>Price</th>
          <th>Quantity</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-product>
        <tr>
          <td>{{ product.sku }}</td>
          <td>{{ product.name }}</td>
          <td>{{ product.category || '-' }}</td>
          <td>{{ product.price | currency }}</td>
          <td>{{ product.quantity }}</td>
          <td>
            <p-tag
              [value]="product.active ? 'Active' : 'Inactive'"
              [severity]="product.active ? 'success' : 'danger'"
            ></p-tag>
          </td>
          <td>
            <p-button
              icon="pi pi-pencil"
              (onClick)="showEditDialog(product)"
              [text]="true"
              [rounded]="true"
              severity="info"
            ></p-button>
            <p-button
              icon="pi pi-trash"
              (onClick)="deleteProduct(product)"
              [text]="true"
              [rounded]="true"
              severity="danger"
            ></p-button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center">No products found.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<p-dialog
  [(visible)]="displayDialog"
  [header]="isEditMode ? 'Edit Product' : 'Add Product'"
  [modal]="true"
  [style]="{ width: '50vw' }"
  [draggable]="false"
  [resizable]="false"
>
  <form class="flex flex-column gap-3">
    <div class="field">
      <label for="name">Product Name *</label>
      <input
        id="name"
        type="text"
        pInputText
        [(ngModel)]="productForm.name"
        name="name"
        class="w-full"
        required
      />
    </div>

    <div class="field">
      <label for="sku">SKU *</label>
      <input
        id="sku"
        type="text"
        pInputText
        [(ngModel)]="productForm.sku"
        name="sku"
        class="w-full"
        required
      />
    </div>

    <div class="grid">
      <div class="col-6">
        <div class="field">
          <label for="price">Price *</label>
          <p-inputNumber
            id="price"
            [(ngModel)]="productForm.price"
            name="price"
            mode="currency"
            currency="USD"
            locale="en-US"
            [minFractionDigits]="2"
            styleClass="w-full"
          ></p-inputNumber>
        </div>
      </div>
      <div class="col-6">
        <div class="field">
          <label for="quantity">Quantity *</label>
          <p-inputNumber
            id="quantity"
            [(ngModel)]="productForm.quantity"
            name="quantity"
            [showButtons]="true"
            [min]="0"
            styleClass="w-full"
          ></p-inputNumber>
        </div>
      </div>
    </div>

    <div class="field">
      <label for="category">Category</label>
      <input
        id="category"
        type="text"
        pInputText
        [(ngModel)]="productForm.category"
        name="category"
        class="w-full"
      />
    </div>

    <div class="field">
      <label for="brand">Brand</label>
      <input
        id="brand"
        type="text"
        pInputText
        [(ngModel)]="productForm.brand"
        name="brand"
        class="w-full"
      />
    </div>

    <div class="field">
      <label for="description">Description</label>
      <textarea
        id="description"
        pInputTextarea
        [(ngModel)]="productForm.description"
        name="description"
        rows="3"
        class="w-full"
      ></textarea>
    </div>

    <div class="field">
      <p-checkbox
        [(ngModel)]="productForm.active"
        name="active"
        [binary]="true"
        label="Active"
      ></p-checkbox>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <p-button
      label="Cancel"
      icon="pi pi-times"
      (onClick)="hideDialog()"
      severity="secondary"
    ></p-button>
    <p-button
      label="Save"
      icon="pi pi-check"
      (onClick)="saveProduct()"
    ></p-button>
  </ng-template>
</p-dialog>
